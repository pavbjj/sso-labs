<IfModule mod_ssl.c>
    <VirtualHost *:443>
        ServerName sso.test.com
        SSLProxyEngine on
        ProxyPreserveHost on
        ProxyPass / http://10.171.176.131:80/
        ProxyPassReverse / http://10.171.176.131:80/

        # SSL configuration
        SSLEngine on
        SSLCertificateFile /etc/apache2/mellon/sp.crt
        SSLCertificateKeyFile /etc/apache2/mellon/sp.key
        # Mellon SP authentication for all requests
        <Location />

            MellonEnable auth
            AuthType Mellon
            Require valid-user
            MellonVariable "cookie"
            MellonSecureCookie On
            MellonSessionIdleTimeout 600
            MellonSPMetadataFile   /etc/apache2/mellon/sp_metadata.xml
            MellonSPPrivateKeyFile /etc/apache2/mellon/sp.key
            MellonSPCertFile       /etc/apache2/mellon/sp.crt
            MellonIdPMetadataFile  /etc/apache2/mellon/idp_metadata.xml
            Header always set X-Forwarded-For "%{REMOTE_ADDR}e"
            Header always set X-Forwarded-Proto "https"
            Header always set X-Forwarded-Port "443"
        </Location>


        # Keycloak POST response endpoint (must be open for POST)

        # Logging
        LogLevel auth_mellon:debug
        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

    </VirtualHost>
